
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>mylifeecho - EF Code First Attached/Detached entities</title>
    <meta name="description" content="POCO-classes in Entity Framework Code First might have two states: attached and detached. In the state attached to the context all changes are detected and in case they exist, the use of method SaveChanges() writes current state to database. If the object is not attached, the changes won't certainly be detected and saved to the database.">
    <meta name="author" content="Alexey Rodiontsev">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/assets/themes/lifeecho/stylesheets/base.css">
    <link rel="stylesheet" href="/assets/themes/lifeecho/stylesheets/skeleton.css">
    <link rel="stylesheet" href="/assets/themes/lifeecho/stylesheets/layout.css">
    <link rel="stylesheet" href="/assets/themes/lifeecho/stylesheets/theme.css">
    <link rel="stylesheet" href="/assets/themes/lifeecho/stylesheets/github.css">

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Favicons
    ================================================== -->
    <link rel="shortcut icon" href="/assets/themes/lifeecho/images/favicon.ico">
    <link rel="apple-touch-icon" href="/assets/themes/lifeecho/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/themes/lifeecho/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/themes/lifeecho/images/apple-touch-icon-114x114.png">
  </head>

  <body>
      <div id="header" class="sixteen columns">
          <div id="header-container" class="container">
              <div id="branding" class="five columns">
                  <h1><a href="/">mylifeecho</a></h1>
                  <h5>Alexey Rodiontsev's personal blog</h5>
              </div>
              <div id="layout-navigation">
                  <nav>
                    <ul class="menu menu-main-menu">
                      <li class="first"><a href="/">Blog</a></li>
                      <li><a href="/notes-tips-tricks">Notes, Tips and Tricks</a></li>
                      <li class="last"><a href="/about">About</a></li>
                    </ul>
                  </nav>
              </div>
          </div>
      </div>
      <div id="main" class="container">
        <div class="content eleven columns">
          
<article class="content-item blog-post">
  <header>
    <h1>EF Code First Attached/Detached entities </h1>
    
    <div class="tags">Tags:
      <ul class="tag_box inline">
        
        


  
     
    	<li><a href="#EF Code First-ref">EF Code First <span>1</span></a></li>
    
  



      </ul>
    </div>
    
    <div class="metadata">
      <div class="published">12 Sep 2012</div>
    </div>
  </header>

  <p>POCO-classes in Entity Framework Code First can have two states: attached and detached. In the state attached to the context all changes are detected and in case they exist, the usage of method SaveChanges() writes current state to database. If the object is not attached, the changes won&#39;t certainly be detected and saved to the database. The object can be attached by using <em>Attach</em> method of <em>DbSet</em>, but some additional actions are still required because recently attached object has state Unchaged.</p>

<p>The code below shows what is necessary to do.</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">_context</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="nf">Attach</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
<span class="n">_context</span><span class="p">.</span><span class="nf">Entry</span><span class="p">(</span><span class="n">user</span><span class="p">).</span><span class="n">State</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">EntityState</span><span class="p">.</span><span class="n">Modified</span><span class="p">;</span>
<span class="n">_context</span><span class="p">.</span><span class="nf">SaveChanges</span><span class="p">();</span>
</code></pre></div>
<p>Bear in mind that if a user with the same Id already exists in ObjectStateManager (for example you successfuly found user with this Id in database before), you will get exception about problem with tracking two entities with the same key. So you can use follow method: _context.Users.<strong>AsNoTracking()</strong>.FirstOrDefault(x =&gt; x.Id == user.Id);</p>


  


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'mylifeecho'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>





</article>

        </div>
        <div class="sidebar five columns">
          <article class="widget">
    <header>
        <h3>About me</h3>
    </header>
    <p>My name is Alexey Rodiontsev. I&rsquo;m a software engineer at Irdeto B.V., Amsterdam, The Netherlands.</p>
</article>
<article class="widget">
    <header>
        <h3>Connect</h3> 
    </header>
    <p>
      <a href="https://twitter.com/klappvisor" title="twitter">
        <img src="/assets/sidebar/c-icon-twi.png" alt="" width="64" height="64" />
      </a>
      <a href="https://github.com/klappvisor" title="GitHub">
        <img src="/assets/sidebar/c-icon-git.png" alt="" width="64" height="64" />
      </a>
      <a href="http://www.linkedin.com/in/alexeyrodiontsev" title="Linked In">
        <img src="/assets/sidebar/c-icon-in.png" alt="" width="64" height="64" />
      </a>
      <a href="http://feeds.feedburner.com/mylifeecho" title="RSS">
        <img src="/assets/sidebar/c-icon-rss.png" alt="" width="64" height="64" />
      </a>
      <a href="http://stackoverflow.com/users/793874/" title="stackoverflow">
        <img src="/assets/sidebar/icon-stacko.png" alt="" width="64" height="64" />
      </a>
      <a href="https://github.com/mylifeecho" title="examples">
        <img src="/assets/sidebar/c-icon-git.png" alt="" style="margin-left: 5px; margin-bottom: 3px;" width="32" height="32" />
      </a>
    </p>
</article>
<article class="widget">
    <header>
        <h3>Recommended Reading</h3>
    </header>
    <ul style="padding-left: 0;">
      <li><a href="/books#code-complete">Code Complete</a></li>
      <li><a href="/books#design-patterns">Design patterns : elements of reusable object-oriented software</a></li>
      <li><a href="/books#csharp-in-a-nutshell">C# in a Nutshell</a></li>
      <li><a href="/books#31days-of-refactoring">31 days of refactoring</a></li>
    </ul>
    <p></p>
</article>
<article class="widget">
    <header>
        <h3>Others</h3>
    </header>
    <p>
      <a href="/certifications">
        <img src="/assets/sidebar/MCSD(rgb)_1477.png" alt="MCSD: Web Applications" style="float: initial;" width="217" height="63" />
      </a>
    </p>
    <p></p>
</article>
        </div>
      </div>
      
      <div id="footer-wrapper">
          <footer class="container">
              <p>&copy; 2015 Alexey Rodiontsev
                with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
              </p>
          </footer>
      </div>

    
  </body>
</html>
